---
ID: 3753
post_title: >
  Python网络爬虫与信息提取（第1周）知识点整理
post_name: 'python%e7%bd%91%e7%bb%9c%e7%88%ac%e8%99%ab%e4%b8%8e%e4%bf%a1%e6%81%af%e6%8f%90%e5%8f%96%ef%bc%88%e7%ac%ac1%e5%91%a8%ef%bc%89%e7%9f%a5%e8%af%86%e7%82%b9%e6%95%b4%e7%90%86'
author: 小奥
post_date: 2018-04-20 08:50:02
layout: post
link: >
  http://www.yushuai.me/2018/04/20/3753.html
published: true
tags:
  - Python
  - python学习
  - 网络爬虫
categories:
  - Python
---
<h1>第一周：网路爬虫之规则</h1><h2>单元1：Requests库入门</h2><p><strong>1.Requests库综述</strong></p><p style="text-align:center">表1.1 Requests库的7个主要方法</p><table><tbody><tr class="firstRow"><td width="123" valign="top" style="border-width: 1px; border-color: windowtext; padding: 0px 7px;"><p style="text-align:center">方法</p></td><td width="431" valign="top" style="border-top-width: 1px; border-right-width: 1px; border-bottom-width: 1px; border-top-color: windowtext; border-right-color: windowtext; border-bottom-color: windowtext; border-left: none; padding: 0px 7px;"><p style="text-align:center">说明</p></td></tr><tr><td width="123" valign="top" style="border-right-width: 1px; border-bottom-width: 1px; border-left-width: 1px; border-right-color: windowtext; border-bottom-color: windowtext; border-left-color: windowtext; border-top: none; padding: 0px 7px;"><p style="text-align:center">request()</p></td><td width="431" valign="top" style="border-top: none; border-left: none; border-bottom-width: 1px; border-bottom-color: windowtext; border-right-width: 1px; border-right-color: windowtext; padding: 0px 7px;"><p>构造一个请求，支撑以下各方法的基础方法</p></td></tr><tr><td width="123" valign="top" style="border-right-width: 1px; border-bottom-width: 1px; border-left-width: 1px; border-right-color: windowtext; border-bottom-color: windowtext; border-left-color: windowtext; border-top: none; padding: 0px 7px;"><p style="text-align:center">get()</p></td><td width="431" valign="top" style="border-top: none; border-left: none; border-bottom-width: 1px; border-bottom-color: windowtext; border-right-width: 1px; border-right-color: windowtext; padding: 0px 7px;"><p>获取HTML网页的主要方法，对应于HTTP的GET</p></td></tr><tr><td width="123" valign="top" style="border-right-width: 1px; border-bottom-width: 1px; border-left-width: 1px; border-right-color: windowtext; border-bottom-color: windowtext; border-left-color: windowtext; border-top: none; padding: 0px 7px;"><p style="text-align:center">head()</p></td><td width="431" valign="top" style="border-top: none; border-left: none; border-bottom-width: 1px; border-bottom-color: windowtext; border-right-width: 1px; border-right-color: windowtext; padding: 0px 7px;"><p>获取HTML网页头的主要方法，对应于HTTP的HEAD</p></td></tr><tr><td width="123" valign="top" style="border-right-width: 1px; border-bottom-width: 1px; border-left-width: 1px; border-right-color: windowtext; border-bottom-color: windowtext; border-left-color: windowtext; border-top: none; padding: 0px 7px;"><p style="text-align:center">post()</p></td><td width="431" valign="top" style="border-top: none; border-left: none; border-bottom-width: 1px; border-bottom-color: windowtext; border-right-width: 1px; border-right-color: windowtext; padding: 0px 7px;"><p>向HTML网页提交POST请求的方法，对应于HTTP的POST</p></td></tr><tr><td width="123" valign="top" style="border-right-width: 1px; border-bottom-width: 1px; border-left-width: 1px; border-right-color: windowtext; border-bottom-color: windowtext; border-left-color: windowtext; border-top: none; padding: 0px 7px;"><p style="text-align:center">put()</p></td><td width="431" valign="top" style="border-top: none; border-left: none; border-bottom-width: 1px; border-bottom-color: windowtext; border-right-width: 1px; border-right-color: windowtext; padding: 0px 7px;"><p>向HTML网页提交PUT请求的方法，对应于HTTP的PUT</p></td></tr><tr><td width="123" valign="top" style="border-right-width: 1px; border-bottom-width: 1px; border-left-width: 1px; border-right-color: windowtext; border-bottom-color: windowtext; border-left-color: windowtext; border-top: none; padding: 0px 7px;"><p style="text-align:center">patch()</p></td><td width="431" valign="top" style="border-top: none; border-left: none; border-bottom-width: 1px; border-bottom-color: windowtext; border-right-width: 1px; border-right-color: windowtext; padding: 0px 7px;"><p>向HTML网页提交局部修改请求，对应于HTTP的PATCH</p></td></tr><tr><td width="123" valign="top" style="border-right-width: 1px; border-bottom-width: 1px; border-left-width: 1px; border-right-color: windowtext; border-bottom-color: windowtext; border-left-color: windowtext; border-top: none; padding: 0px 7px;"><p style="text-align:center">delete()</p></td><td width="431" valign="top" style="border-top: none; border-left: none; border-bottom-width: 1px; border-bottom-color: windowtext; border-right-width: 1px; border-right-color: windowtext; padding: 0px 7px;"><p>向HTML页面提交删除请求，对应于HTTP的DELETE</p></td></tr></tbody></table><p><strong>2.Requests库的get()方法</strong></p><p style="text-indent:28px">最简单的获取网址的方式是：</p><pre class="brush:python;toolbar:false">r=&nbsp;requests.get(&quot;http://www.yushuai.me&quot;)</pre><p style="text-indent:28px">这之中，requests是构造了一个向服务器请求资源的Request对象，r是返回一个包含服务器资源的Response对象。get完全的使用方法是：</p><pre class="brush:python;toolbar:false">requests.get(url,params=None,**kwargs)</pre><p style="text-indent:28px">其中，url是拟获取页面的url链接；params是url中的额外参数，字典或字节流格式，可选；**kwargs是13个控制参数。</p><p style="text-align:center">表1.2 Response对象的属性</p><table><tbody><tr class="firstRow"><td width="123" valign="top" style="border-width: 1px; border-color: windowtext; padding: 0px 7px;"><p style="text-align:center">方法</p></td><td width="431" valign="top" style="border-top-width: 1px; border-right-width: 1px; border-bottom-width: 1px; border-top-color: windowtext; border-right-color: windowtext; border-bottom-color: windowtext; border-left: none; padding: 0px 7px;"><p style="text-align:center">说明</p></td></tr><tr><td width="123" valign="top" style="border-right-width: 1px; border-bottom-width: 1px; border-left-width: 1px; border-right-color: windowtext; border-bottom-color: windowtext; border-left-color: windowtext; border-top: none; padding: 0px 7px;"><p>r.status_code</p></td><td width="431" valign="top" style="border-top: none; border-left: none; border-bottom-width: 1px; border-bottom-color: windowtext; border-right-width: 1px; border-right-color: windowtext; padding: 0px 7px;"><p>HTTP请求的返回状态。200表示连接成功，404表示失败。</p></td></tr><tr><td width="123" valign="top" style="border-right-width: 1px; border-bottom-width: 1px; border-left-width: 1px; border-right-color: windowtext; border-bottom-color: windowtext; border-left-color: windowtext; border-top: none; padding: 0px 7px;"><p>r.text</p></td><td width="431" valign="top" style="border-top: none; border-left: none; border-bottom-width: 1px; border-bottom-color: windowtext; border-right-width: 1px; border-right-color: windowtext; padding: 0px 7px;"><p>HTTP响应内容的字符串形式，即url对应的页面内容</p></td></tr><tr><td width="123" valign="top" style="border-right-width: 1px; border-bottom-width: 1px; border-left-width: 1px; border-right-color: windowtext; border-bottom-color: windowtext; border-left-color: windowtext; border-top: none; padding: 0px 7px;"><p>r.encoding</p></td><td width="431" valign="top" style="border-top: none; border-left: none; border-bottom-width: 1px; border-bottom-color: windowtext; border-right-width: 1px; border-right-color: windowtext; padding: 0px 7px;"><p>从HTTP header中猜测的响应内容编码方式</p></td></tr><tr><td width="123" valign="top" style="border-right-width: 1px; border-bottom-width: 1px; border-left-width: 1px; border-right-color: windowtext; border-bottom-color: windowtext; border-left-color: windowtext; border-top: none; padding: 0px 7px;"><p>r.apparent_encoding</p></td><td width="431" valign="top" style="border-top: none; border-left: none; border-bottom-width: 1px; border-bottom-color: windowtext; border-right-width: 1px; border-right-color: windowtext; padding: 0px 7px;"><p>从内容中分析出的响应内容编码方式（备用编码方式）</p></td></tr><tr><td width="123" valign="top" style="border-right-width: 1px; border-bottom-width: 1px; border-left-width: 1px; border-right-color: windowtext; border-bottom-color: windowtext; border-left-color: windowtext; border-top: none; padding: 0px 7px;"><p>r.content</p></td><td width="431" valign="top" style="border-top: none; border-left: none; border-bottom-width: 1px; border-bottom-color: windowtext; border-right-width: 1px; border-right-color: windowtext; padding: 0px 7px;"><p>HTTP响应内容的二进制形式</p></td></tr></tbody></table><p>注意：</p><p>r.encoding：如果header中不存在charset，则认为编码为ISO-8859-1，所以header中编码不一定正确。</p><p>r.apparent_encoding：根据网页内容分析出的编码方式。</p><p><strong>2.爬取网页的通用代码框架</strong></p><p style="text-align:center">表1.3 Requests库的异常</p><table><tbody><tr class="firstRow"><td width="160" valign="top" style="border-width: 1px; border-color: windowtext; padding: 0px 7px;"><p style="text-align:center">异常</p></td><td width="393" valign="top" style="border-top-width: 1px; border-right-width: 1px; border-bottom-width: 1px; border-top-color: windowtext; border-right-color: windowtext; border-bottom-color: windowtext; border-left: none; padding: 0px 7px;"><p style="text-align:center">说明</p></td></tr><tr><td width="160" valign="top" style="border-right-width: 1px; border-bottom-width: 1px; border-left-width: 1px; border-right-color: windowtext; border-bottom-color: windowtext; border-left-color: windowtext; border-top: none; padding: 0px 7px;"><p>requests.ConnectionError</p></td><td width="393" valign="top" style="border-top: none; border-left: none; border-bottom-width: 1px; border-bottom-color: windowtext; border-right-width: 1px; border-right-color: windowtext; padding: 0px 7px;"><p>网络连接错误异常，如DNS查询失败、拒绝连接等</p></td></tr><tr><td width="160" valign="top" style="border-right-width: 1px; border-bottom-width: 1px; border-left-width: 1px; border-right-color: windowtext; border-bottom-color: windowtext; border-left-color: windowtext; border-top: none; padding: 0px 7px;"><p>requests.HTTPError</p></td><td width="393" valign="top" style="border-top: none; border-left: none; border-bottom-width: 1px; border-bottom-color: windowtext; border-right-width: 1px; border-right-color: windowtext; padding: 0px 7px;"><p>HTTP错误异常</p></td></tr><tr><td width="160" valign="top" style="border-right-width: 1px; border-bottom-width: 1px; border-left-width: 1px; border-right-color: windowtext; border-bottom-color: windowtext; border-left-color: windowtext; border-top: none; padding: 0px 7px;"><p>requests.URLRequired</p></td><td width="393" valign="top" style="border-top: none; border-left: none; border-bottom-width: 1px; border-bottom-color: windowtext; border-right-width: 1px; border-right-color: windowtext; padding: 0px 7px;"><p>URL缺失异常</p></td></tr><tr><td width="160" valign="top" style="border-right-width: 1px; border-bottom-width: 1px; border-left-width: 1px; border-right-color: windowtext; border-bottom-color: windowtext; border-left-color: windowtext; border-top: none; padding: 0px 7px;"><p>requests.TooManyRedirects</p></td><td width="393" valign="top" style="border-top: none; border-left: none; border-bottom-width: 1px; border-bottom-color: windowtext; border-right-width: 1px; border-right-color: windowtext; padding: 0px 7px;"><p>超过最大重定向次数，产生重定向异常</p></td></tr><tr><td width="160" valign="top" style="border-right-width: 1px; border-bottom-width: 1px; border-left-width: 1px; border-right-color: windowtext; border-bottom-color: windowtext; border-left-color: windowtext; border-top: none; padding: 0px 7px;"><p>requests.ConnectTimeout</p></td><td width="393" valign="top" style="border-top: none; border-left: none; border-bottom-width: 1px; border-bottom-color: windowtext; border-right-width: 1px; border-right-color: windowtext; padding: 0px 7px;"><p>连接远程服务器超时异常</p></td></tr><tr><td width="160" valign="top" style="border-right-width: 1px; border-bottom-width: 1px; border-left-width: 1px; border-right-color: windowtext; border-bottom-color: windowtext; border-left-color: windowtext; border-top: none; padding: 0px 7px;"><p>requests.Timeout</p></td><td width="393" valign="top" style="border-top: none; border-left: none; border-bottom-width: 1px; border-bottom-color: windowtext; border-right-width: 1px; border-right-color: windowtext; padding: 0px 7px;"><p>请求URL超时，产生超时异常</p></td></tr><tr><td width="160" valign="top" style="border-right-width: 1px; border-bottom-width: 1px; border-left-width: 1px; border-right-color: windowtext; border-bottom-color: windowtext; border-left-color: windowtext; border-top: none; padding: 0px 7px;"><p>r.raise_for_status()</p></td><td width="393" valign="top" style="border-top: none; border-left: none; border-bottom-width: 1px; border-bottom-color: windowtext; border-right-width: 1px; border-right-color: windowtext; padding: 0px 7px;"><p>如果不是200，产生异常requests.HTTPError</p></td></tr></tbody></table><p>&nbsp;</p><p style="text-indent:28px">爬取网页的通用代码框架如下所示：</p><pre class="brush:python;toolbar:false">import&nbsp;requests
&nbsp;
def&nbsp;getHTMLText(url):
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;try:
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;r=requests.get(url,timeout=30)
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;r.raise_for_status()#如果状态不是200，引发HTTPError异常
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;r.encoding&nbsp;=&nbsp;r.apparent_encoding
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;r.text
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;except:
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;&quot;产生异常&quot;
&nbsp;
if&nbsp;__name__&nbsp;==&quot;__main__&quot;:
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;url&nbsp;=&nbsp;&quot;http://www.baidu.com&quot;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;print(getHTMLText(url))</pre><p><strong>3.HTTP协议及Requests库方法</strong></p><p style="text-align:center">表1.4 HTTP协议对资源的操作</p><table><tbody><tr class="firstRow"><td width="123" valign="top" style="border-width: 1px; border-color: windowtext; padding: 0px 7px;"><p style="text-align:center">方法</p></td><td width="431" valign="top" style="border-top-width: 1px; border-right-width: 1px; border-bottom-width: 1px; border-top-color: windowtext; border-right-color: windowtext; border-bottom-color: windowtext; border-left: none; padding: 0px 7px;"><p style="text-align:center">说明</p></td></tr><tr><td width="123" valign="top" style="border-right-width: 1px; border-bottom-width: 1px; border-left-width: 1px; border-right-color: windowtext; border-bottom-color: windowtext; border-left-color: windowtext; border-top: none; padding: 0px 7px;"><p style="text-align:center">GET</p></td><td width="431" valign="top" style="border-top: none; border-left: none; border-bottom-width: 1px; border-bottom-color: windowtext; border-right-width: 1px; border-right-color: windowtext; padding: 0px 7px;"><p>请求获取URL位置的资源</p></td></tr><tr><td width="123" valign="top" style="border-right-width: 1px; border-bottom-width: 1px; border-left-width: 1px; border-right-color: windowtext; border-bottom-color: windowtext; border-left-color: windowtext; border-top: none; padding: 0px 7px;"><p style="text-align:center">HEAD</p></td><td width="431" valign="top" style="border-top: none; border-left: none; border-bottom-width: 1px; border-bottom-color: windowtext; border-right-width: 1px; border-right-color: windowtext; padding: 0px 7px;"><p>请求获取URL位置资源的相应消息报告，即获取头部信息</p></td></tr><tr><td width="123" valign="top" style="border-right-width: 1px; border-bottom-width: 1px; border-left-width: 1px; border-right-color: windowtext; border-bottom-color: windowtext; border-left-color: windowtext; border-top: none; padding: 0px 7px;"><p style="text-align:center">POST</p></td><td width="431" valign="top" style="border-top: none; border-left: none; border-bottom-width: 1px; border-bottom-color: windowtext; border-right-width: 1px; border-right-color: windowtext; padding: 0px 7px;"><p>请求向URL位置的资源后附加新的数据（<strong>不改变原有，只增加</strong>）</p></td></tr><tr><td width="123" valign="top" style="border-right-width: 1px; border-bottom-width: 1px; border-left-width: 1px; border-right-color: windowtext; border-bottom-color: windowtext; border-left-color: windowtext; border-top: none; padding: 0px 7px;"><p style="text-align:center">PUT</p></td><td width="431" valign="top" style="border-top: none; border-left: none; border-bottom-width: 1px; border-bottom-color: windowtext; border-right-width: 1px; border-right-color: windowtext; padding: 0px 7px;"><p>请求向URL位置存储一个资源，<strong>覆盖原URL位置的资源</strong></p></td></tr><tr><td width="123" valign="top" style="border-right-width: 1px; border-bottom-width: 1px; border-left-width: 1px; border-right-color: windowtext; border-bottom-color: windowtext; border-left-color: windowtext; border-top: none; padding: 0px 7px;"><p style="text-align:center">PATCH</p></td><td width="431" valign="top" style="border-top: none; border-left: none; border-bottom-width: 1px; border-bottom-color: windowtext; border-right-width: 1px; border-right-color: windowtext; padding: 0px 7px;"><p>请求局部更新URL位置的资源，即改变该处资源的部分内容</p></td></tr><tr><td width="123" valign="top" style="border-right-width: 1px; border-bottom-width: 1px; border-left-width: 1px; border-right-color: windowtext; border-bottom-color: windowtext; border-left-color: windowtext; border-top: none; padding: 0px 7px;"><p style="text-align:center">DELETE</p></td><td width="431" valign="top" style="border-top: none; border-left: none; border-bottom-width: 1px; border-bottom-color: windowtext; border-right-width: 1px; border-right-color: windowtext; padding: 0px 7px;"><p>请求删除URL位置存储的资源</p></td></tr></tbody></table><p><strong><span style="color:red">注意：理解PATCH和PUT的区别</span></strong></p><p style="text-indent:28px"><span style="color:red">假设URL位置有一组数据UserInfo，包括UserID、UserName等20个字段。需求：用户修改了UserName，其他不变。</span></p><p style="text-indent:28px"><span style="color:red">（1）若使用PATCH，仅向Url提交UserName的局部更新请求。</span></p><p style="text-indent:28px"><span style="color:red">（2）若使用PUT，必须将所有20个字段一并提交到URL，未提及的字段会被删除。</span></p><p><strong>4.Requests库主要方法解析</strong></p><p>（1）requests.request(method,url,**kwargs)</p><p style="text-indent:28px">其中，method是请求方式；url是拟获取页面的url链接；**kwargs是控制访问的参数，共13个。</p><p style="text-indent:28px">method请求方式包括：</p><p style="text-indent:28px">①r=requests.request(‘GET’,url,**kwargs)</p><p style="text-indent:28px">②r=requests.request(‘HEAD’,url,**kwargs)</p><p style="text-indent:28px">③r=requests.request(‘POST’,url,**kwargs)</p><p style="text-indent:28px">④r=requests.request(‘PUT’,url,**kwargs)</p><p style="text-indent:28px">⑤r=requests.request(‘PATCH’,url,**kwargs)</p><p style="text-indent:28px">⑥r=requests.request(‘delete’,url,**kwargs)</p><p style="text-indent:28px">⑦r=requests.request(‘OPTIONS’,url,**kwargs)向服务器获取服务器和客户端通信的参数。</p><p style="text-indent:28px">**kwargs参数如表1.5所示。</p><p style="text-align:center">表1.5 参数表</p><table><tbody><tr class="firstRow"><td width="123" valign="top" style="border-width: 1px; border-color: windowtext; padding: 0px 7px;"><p style="text-align:center">参数</p></td><td width="431" valign="top" style="border-top-width: 1px; border-right-width: 1px; border-bottom-width: 1px; border-top-color: windowtext; border-right-color: windowtext; border-bottom-color: windowtext; border-left: none; padding: 0px 7px;"><p style="text-align:center">说明</p></td></tr><tr><td width="123" valign="top" style="border-right-width: 1px; border-bottom-width: 1px; border-left-width: 1px; border-right-color: windowtext; border-bottom-color: windowtext; border-left-color: windowtext; border-top: none; padding: 0px 7px;"><p style="text-align:center"><strong>params</strong></p></td><td width="431" valign="top" style="border-top: none; border-left: none; border-bottom-width: 1px; border-bottom-color: windowtext; border-right-width: 1px; border-right-color: windowtext; padding: 0px 7px;"><p>字典或字节序列，作为参数增加到url中。</p></td></tr><tr><td width="123" valign="top" style="border-right-width: 1px; border-bottom-width: 1px; border-left-width: 1px; border-right-color: windowtext; border-bottom-color: windowtext; border-left-color: windowtext; border-top: none; padding: 0px 7px;"><p style="text-align:center"><strong>data</strong></p></td><td width="431" valign="top" style="border-top: none; border-left: none; border-bottom-width: 1px; border-bottom-color: windowtext; border-right-width: 1px; border-right-color: windowtext; padding: 0px 7px;"><p>字典、字节序列或文件对象，作为Request的内容。</p></td></tr><tr><td width="123" valign="top" style="border-right-width: 1px; border-bottom-width: 1px; border-left-width: 1px; border-right-color: windowtext; border-bottom-color: windowtext; border-left-color: windowtext; border-top: none; padding: 0px 7px;"><p style="text-align:center"><strong>json</strong></p></td><td width="431" valign="top" style="border-top: none; border-left: none; border-bottom-width: 1px; border-bottom-color: windowtext; border-right-width: 1px; border-right-color: windowtext; padding: 0px 7px;"><p>JSON格式的数据，作为Request的内容。</p></td></tr><tr><td width="123" valign="top" style="border-right-width: 1px; border-bottom-width: 1px; border-left-width: 1px; border-right-color: windowtext; border-bottom-color: windowtext; border-left-color: windowtext; border-top: none; padding: 0px 7px;"><p style="text-align:center"><strong>headers</strong></p></td><td width="431" valign="top" style="border-top: none; border-left: none; border-bottom-width: 1px; border-bottom-color: windowtext; border-right-width: 1px; border-right-color: windowtext; padding: 0px 7px;"><p>字典，HTTP定制头。</p></td></tr><tr><td width="123" valign="top" style="border-right-width: 1px; border-bottom-width: 1px; border-left-width: 1px; border-right-color: windowtext; border-bottom-color: windowtext; border-left-color: windowtext; border-top: none; padding: 0px 7px;"><p style="text-align:center">cookies</p></td><td width="431" valign="top" style="border-top: none; border-left: none; border-bottom-width: 1px; border-bottom-color: windowtext; border-right-width: 1px; border-right-color: windowtext; padding: 0px 7px;"><p>字典或CookieJar，Request中的cookie。</p></td></tr><tr><td width="123" valign="top" style="border-right-width: 1px; border-bottom-width: 1px; border-left-width: 1px; border-right-color: windowtext; border-bottom-color: windowtext; border-left-color: windowtext; border-top: none; padding: 0px 7px;"><p style="text-align:center">auth</p></td><td width="431" valign="top" style="border-top: none; border-left: none; border-bottom-width: 1px; border-bottom-color: windowtext; border-right-width: 1px; border-right-color: windowtext; padding: 0px 7px;"><p>元组，支持HTTP认证功能。</p></td></tr><tr><td width="123" valign="top" style="border-right-width: 1px; border-bottom-width: 1px; border-left-width: 1px; border-right-color: windowtext; border-bottom-color: windowtext; border-left-color: windowtext; border-top: none; padding: 0px 7px;"><p style="text-align:center">files</p></td><td width="431" valign="top" style="border-top: none; border-left: none; border-bottom-width: 1px; border-bottom-color: windowtext; border-right-width: 1px; border-right-color: windowtext; padding: 0px 7px;"><p>字典类型，传输文件。</p></td></tr><tr><td width="123" valign="top" style="border-right-width: 1px; border-bottom-width: 1px; border-left-width: 1px; border-right-color: windowtext; border-bottom-color: windowtext; border-left-color: windowtext; border-top: none; padding: 0px 7px;"><p style="text-align:center">timeout</p></td><td width="431" valign="top" style="border-top: none; border-left: none; border-bottom-width: 1px; border-bottom-color: windowtext; border-right-width: 1px; border-right-color: windowtext; padding: 0px 7px;"><p>设定超时时间，秒为单位。</p></td></tr><tr><td width="123" valign="top" style="border-right-width: 1px; border-bottom-width: 1px; border-left-width: 1px; border-right-color: windowtext; border-bottom-color: windowtext; border-left-color: windowtext; border-top: none; padding: 0px 7px;"><p style="text-align:center">proxies</p></td><td width="431" valign="top" style="border-top: none; border-left: none; border-bottom-width: 1px; border-bottom-color: windowtext; border-right-width: 1px; border-right-color: windowtext; padding: 0px 7px;"><p>字典类型，设计访问代理服务器，可以增加登录认证。</p></td></tr><tr><td width="123" valign="top" style="border-right-width: 1px; border-bottom-width: 1px; border-left-width: 1px; border-right-color: windowtext; border-bottom-color: windowtext; border-left-color: windowtext; border-top: none; padding: 0px 7px;"><p style="text-align:center"><em><span style="color:gray">allow_redirects</span></em></p></td><td width="431" valign="top" style="border-top: none; border-left: none; border-bottom-width: 1px; border-bottom-color: windowtext; border-right-width: 1px; border-right-color: windowtext; padding: 0px 7px;"><p>默认为True，重定向开关。</p></td></tr><tr><td width="123" valign="top" style="border-right-width: 1px; border-bottom-width: 1px; border-left-width: 1px; border-right-color: windowtext; border-bottom-color: windowtext; border-left-color: windowtext; border-top: none; padding: 0px 7px;"><p style="text-align:center"><em><span style="color:gray">stream</span></em></p></td><td width="431" valign="top" style="border-top: none; border-left: none; border-bottom-width: 1px; border-bottom-color: windowtext; border-right-width: 1px; border-right-color: windowtext; padding: 0px 7px;"><p>默认为True，获取内容立即下载开关。</p></td></tr><tr><td width="123" valign="top" style="border-right-width: 1px; border-bottom-width: 1px; border-left-width: 1px; border-right-color: windowtext; border-bottom-color: windowtext; border-left-color: windowtext; border-top: none; padding: 0px 7px;"><p style="text-align:center"><em><span style="color:gray">verify</span></em></p></td><td width="431" valign="top" style="border-top: none; border-left: none; border-bottom-width: 1px; border-bottom-color: windowtext; border-right-width: 1px; border-right-color: windowtext; padding: 0px 7px;"><p>默认True，认证SSL证书开关。</p></td></tr><tr><td width="123" valign="top" style="border-right-width: 1px; border-bottom-width: 1px; border-left-width: 1px; border-right-color: windowtext; border-bottom-color: windowtext; border-left-color: windowtext; border-top: none; padding: 0px 7px;"><p style="text-align:center"><span style="color:gray">cert</span></p></td><td width="431" valign="top" style="border-top: none; border-left: none; border-bottom-width: 1px; border-bottom-color: windowtext; border-right-width: 1px; border-right-color: windowtext; padding: 0px 7px;"><p>本地SSL证书路径。</p></td></tr><tr><td width="123" valign="top" style="border-right-width: 1px; border-bottom-width: 1px; border-left-width: 1px; border-right-color: windowtext; border-bottom-color: windowtext; border-left-color: windowtext; border-top: none; padding: 0px 7px;"><br/></td><td width="431" valign="top" style="border-top: none; border-left: none; border-bottom-width: 1px; border-bottom-color: windowtext; border-right-width: 1px; border-right-color: windowtext; padding: 0px 7px;"><br/></td></tr></tbody></table><p>（2）requests.get(url,params=None, **kwargs)</p><p>url：拟获取页面的url链接。</p><p>params：url的额外参数，字典或字节流格式，可选。</p><p>**kwargs：12个控制访问参数（上一个中除了params）。</p><p>（3）requets.head(url,**kwargs)</p><p>**kwargs与request一样，不再累述。</p><p>（4）requests.post(url,data=None,json=None,**kwargs)</p><p>和request一样，不再累述。</p><p>其它也一样，不再累述。</p><p><strong>5.例：Requests库的爬取性能分析</strong></p><pre class="brush:python;toolbar:false">import&nbsp;time
import&nbsp;requests
&nbsp;
def&nbsp;getHTMLText(url):
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;try:
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;r=requests.get(url,timeout=30)
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;r.raise_for_status()#如果状态不是200，引发HTTPError异常
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;r.encoding&nbsp;=&nbsp;r.apparent_encoding
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;r.text
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;except:
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;&quot;产生异常&quot;
&nbsp;
if&nbsp;__name__&nbsp;==&quot;__main__&quot;:
&nbsp;&nbsp;&nbsp;&nbsp;url&nbsp;=&nbsp;&quot;http://www.baidu.com/&quot;
&nbsp;&nbsp;&nbsp;&nbsp;start_time&nbsp;=time.time()
&nbsp;&nbsp;&nbsp;&nbsp;for&nbsp;i&nbsp;in&nbsp;range(100):
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;getHTMLText(url)
&nbsp;&nbsp;&nbsp;&nbsp;end_time&nbsp;=&nbsp;time.time()
&nbsp;&nbsp;&nbsp;&nbsp;dur_time&nbsp;=&nbsp;end_time&nbsp;-&nbsp;start_time
&nbsp;&nbsp;&nbsp;&nbsp;print(&quot;爬取100次网页所需时间：{:.3f}s&quot;.format(dur_time))</pre><h2>单元2：网络爬虫的“盗亦有道”</h2><p><strong>1.网络爬虫规模及问题</strong></p><p style="text-indent:28px">网络爬虫的尺寸主要分为下面三类：</p><p style="text-indent:28px">（1）爬取网页：小规模，数据量小，爬取速度不敏感，使用Requests库。</p><p style="text-indent:28px">（2）爬取网站：中规模，数据规模较大，爬取速度敏感，使用Scrapy库。</p><p style="text-indent:28px">（3）爬取全网：大规模，搜索引擎爬取速度关键，定制开发。</p><p style="text-indent:28px">网络爬虫带来的问题：</p><p style="text-indent:28px">骚扰问题、法律风险、泄漏问题。</p><p><strong>2.Robots协议</strong></p><p>&nbsp;&nbsp;&nbsp; 告知爬虫哪些可以爬取，哪些不可以爬取。</p><h2>单元3：实践</h2><p><strong>1.向百度搜索提交搜索内容</strong></p><p>代码：</p><pre class="brush:python;toolbar:false">import&nbsp;requests
keyword&nbsp;=&nbsp;&#39;Python&#39;
try:
&nbsp;&nbsp;&nbsp;&nbsp;kv&nbsp;=&nbsp;{&#39;wd&#39;:&#39;keyword&#39;}
&nbsp;&nbsp;&nbsp;&nbsp;r=&nbsp;requests.get(&quot;http://www.baidu.com/s&quot;,params=kv)
&nbsp;&nbsp;&nbsp;&nbsp;print(r.raise_for_status)
&nbsp;&nbsp;&nbsp;&nbsp;print(r.request.url)
&nbsp;&nbsp;&nbsp;&nbsp;print(len(r.text))
except:
print(&quot;爬取失败&quot;)</pre><p>结果：</p><p>&lt;bound method Response.raise_for_status of &lt;Response [200]&gt;&gt;</p><p>http://www.baidu.com/s?wd=keyword</p><p>245051</p><p><strong>（注意：原来字典的&#39;wd&#39;:&#39;keyword&#39;，在连接的时候修改为了wd=keyword）</strong></p><p><strong>2.网络图片的爬取和存储</strong></p><p>代码：</p><pre class="brush:python;toolbar:false">import&nbsp;requests
import&nbsp;os
import&nbsp;time
root&nbsp;=&nbsp;&quot;D://pics//&quot;
url&nbsp;=&nbsp;&quot;http://image.nationalgeographic.com.cn/2018/0327/20180327031900693.jpg&quot;
path&nbsp;=&nbsp;root&nbsp;+url.split(&#39;/&#39;)[-1]
start_time&nbsp;=&nbsp;time.time()
try:
&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;not&nbsp;os.path.exists(root):
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;os.mkdir(root)
&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;not&nbsp;os.path.exists(path):
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;r=&nbsp;requests.get(url)
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;big&nbsp;=&nbsp;len(r.text)
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;with&nbsp;open(path,&#39;wb&#39;)&nbsp;as&nbsp;f:
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;f.write(r.content)
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;f.close()
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;print(&quot;文件保存成功&quot;)
&nbsp;&nbsp;&nbsp;&nbsp;else:
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;print(&quot;文件已经存在&quot;)
except:
&nbsp;&nbsp;&nbsp;&nbsp;print(&quot;爬取失败&quot;)
end_time&nbsp;=&nbsp;time.time()
dur_time&nbsp;=&nbsp;end_time-start_time
print(&quot;保存图片用时{0:.3f}s，图片大小为{1}&quot;.format(dur_time,big))</pre><p>结果：</p><p>图片得到保存，且输出：</p><p>文件保存成功</p><p>保存图片用时14.035s，图片大小为682413</p><p><strong>实例5：IP地址归属地的自动查询</strong></p><pre class="brush:python;toolbar:false">import&nbsp;requests
&nbsp;
url&nbsp;=&nbsp;&quot;http://m.ip138.com/ip.asp?ip=&quot;
try:
&nbsp;&nbsp;&nbsp;&nbsp;r=requests.get(url+&#39;113.133.219.95&#39;)
&nbsp;&nbsp;&nbsp;&nbsp;r.raise_for_status()
&nbsp;&nbsp;&nbsp;&nbsp;r.encoding&nbsp;=&nbsp;r.apparent_encoding
&nbsp;&nbsp;&nbsp;&nbsp;print(r.text[-500:])
except:
&nbsp;&nbsp;&nbsp;&nbsp;print(&quot;爬取失败&quot;)</pre><p><br/></p>